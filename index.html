<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
    }
    .route-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      overflow: hidden;
      max-width: 500px;
      margin: 0 auto;
    }
    .map-preview {
      width: 100%;
      height: 200px;
      background: #e5e5e5;
    }
    .route-header {
      padding: 16px;
    }
    .user-section {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }
    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 20px;
      background: #e0e0e0;
      margin-right: 12px;
    }
    .user-info {
      flex: 1;
    }
    .username {
      font-weight: 600;
      margin: 0;
    }
    .timestamp {
      color: #666;
      font-size: 14px;
      margin: 2px 0 0 0;
    }
    .stats {
      display: flex;
      gap: 16px;
      font-size: 14px;
      color: #666;
    }
    .stat {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .social-footer {
      padding: 12px 16px;
      border-top: 1px solid #eee;
      display: flex;
      align-items: center;
      gap: 20px;
      color: #666;
      font-size: 14px;
    }
    .interaction {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }
    .interaction:hover {
      color: #333;
    }
    .leaflet-container {
      background: #f8f8f8;
    }
    .leaflet-control-container {
      display: none;
    }
  </style>
</head>
<body>
  <div class="route-card">
    <div class="route-header">
      <div class="user-section">
        <div class="avatar"></div>
        <div class="user-info">
          <h3 class="username">John Doe</h3>
          <p class="timestamp">2 hours ago</p>
        </div>
      </div>
      <div class="stats">
        <div class="stat">
          üìè <span id="distance">Calculating...</span>
        </div>
        <div class="stat">
          ‚õ∞Ô∏è <span id="elevation">Calculating...</span>
        </div>
        <div class="stat">
          ‚è±Ô∏è <span id="duration">Calculating...</span>
        </div>
        <div class="stat">
          üö¥‚Äç‚ôÇÔ∏è <span id="speed">Calculating...</span>
        </div>
        <div class="stat">
          üíì <span id="heartrate">Calculating...</span>
        </div>
      </div>
    </div>
    
    <div id="map" class="map-preview"></div>
    
    <div class="social-footer">
      <div class="interaction">
        ‚ù§Ô∏è <span>24 likes</span>
      </div>
      <div class="interaction">
        üí¨ <span>3 comments</span>
      </div>
    </div>
  </div>

  <script>
    const map = L.map('map', {
      zoomControl: false,
      dragging: false,
      touchZoom: false,
      scrollWheelZoom: false,
      doubleClickZoom: false
    });
    
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
      attribution: ''
    }).addTo(map);

    const gpxFile = new L.GPX('56_bike_path.gpx', {
      async: true,
      marker_options: {
        startIconUrl: '',
        endIconUrl: '',
        shadowUrl: ''
      },
      polyline_options: {
        color: '#3388ff',
        weight: 3,
        opacity: 0.8
      }
    })
      .on('loaded', function(e) {
        map.fitBounds(e.target.getBounds(), {
          padding: [5, 5]
        });
        
        const track = e.target;
        
        // Calculate duration in seconds
        const startTime = track.get_start_time();
        const endTime = track.get_end_time();
        const durationSecs = (endTime - startTime) / 1000;
        
        document.getElementById('distance').textContent = 
          (track.get_distance() / 1000).toFixed(1) + ' km';
        document.getElementById('elevation').textContent = 
          track.get_elevation_gain().toFixed(0) + 'm gain';
        
          // Format duration based on length
        const formatDuration = (seconds) => {
          if (seconds < 60) {
            return seconds + ' secs';
          } else if (seconds < 3600) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')} mins`;
          } else {
            const hours = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            return `${hours}:${mins.toString().padStart(2, '0')} hrs`;
          }
        };
        
        document.getElementById('duration').textContent = formatDuration(durationSecs);
        
        // Calculate average speed (km/h)
        const distanceKm = track.get_distance() / 1000;
        const durationHours = durationSecs / 3600;
        const avgSpeed = (distanceKm / durationHours).toFixed(1);
        document.getElementById('speed').textContent = `${avgSpeed} km/h`;
        
        // Calculate average heart rate
        let totalHr = 0;
        let hrReadings = 0;
        
        track.get_points().forEach(point => {
          // Get the extensions element
          const extensions = point.querySelector('extensions');
          if (extensions) {
            // Find heart rate data in TrackPointExtension
            const hrElement = extensions.querySelector('gpxtpx\\:TrackPointExtension gpxtpx\\:hr');
            if (hrElement) {
              const hr = parseInt(hrElement.textContent);
              if (!isNaN(hr)) {
                totalHr += hr;
                hrReadings++;
              }
            }
          }
        });
        
        const avgHr = hrReadings > 0 ? Math.round(totalHr / hrReadings) : 'N/A';
        document.getElementById('heartrate').textContent = `${avgHr} bpm`;
      })
      .addTo(map);
  </script>
</body>
</html>
